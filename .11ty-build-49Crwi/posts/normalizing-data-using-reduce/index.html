<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Normalizing data using array.prototype.reduce</title>
    <meta name="description" content="reduce() has terrified me for some time! I hadn&#39;t wanted to touch this new array method because I couldn&#39;t quite follow what each of it&#39;s properties meant. But recently I had an opportunity to deep dive into this function. Here&#39;s how I refactored an object to get the results I needed">
    <meta property="og:site_name" content="Normalizing data using array.prototype.reduce">
    <meta property="og:locale" content="en_GB">
    <meta property="og:type" content="website">
    <meta property="og:description" content="reduce() has terrified me for some time! I hadn&#39;t wanted to touch this new array method because I couldn&#39;t quite follow what each of it&#39;s properties meant. But recently I had an opportunity to deep dive into this function. Here&#39;s how I refactored an object to get the results I needed">
    <meta property="og:title" content="Normalizing data using array.prototype.reduce" />
    <meta property="og:image" content="/img/sharecard-default.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@muzzlehatch_" />
    <meta name="twitter:title" content="Normalizing data using array.prototype.reduce" />
    <meta
      name="twitter:description"
      content="reduce() has terrified me for some time! I hadn&#39;t wanted to touch this new array method because I couldn&#39;t quite follow what each of it&#39;s properties meant. But recently I had an opportunity to deep dive into this function. Here&#39;s how I refactored an object to get the results I needed"
    />
    <meta name="twitter:image" content="/img/sharecard-default.png" />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "headline": "Normalizing data using array.prototype.reduce",
        "author": {
          "@type": "Person",
          "name": "Benjamin Read"
        },
        "datePublished": "2019-07-18T15:21:21+01:00",
        "image": "/img/sharecard-default.png"
      }
    </script>
    <link rel="icon" href="/img/icon.png" type="image/x-icon">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Delicious Reverie">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Delicious Reverie">
  </head>
  <body>
    <a id="skiplinks" href="#main">Skip to main content</a>
    <p class="themeswitcher">Choose theme:</p>
    <label class="themeswitcher" for="dark">Light</label>
    <input class="themeswitcher" type="radio" id="light" name="colors" value="light">
    <label  class="themeswitcher" for="dark">Dark</label>
    <input  class="themeswitcher" type="radio" id="dark" name="colors" value="dark">
    <header>
      <div class="container">
        <div class="title home"><a href="/">Delicious Reverie</a></div>
        <p class="subtitle">blog of developer &amp; bookworm benjamin read</p>
        <nav>
          <ul class="list-inline">
            <li class="nav-item">
              <a href="/">Home</a>
            </li>
            <li class="nav-item">
              <a href="/about/">About</a>
            </li>
            <li class="nav-item">
              <a href="/links/">Links</a>
            </li>
            <li class="nav-item">
              <a href="/posts/">Archive</a>
            </li>
            <li class="nav-item">
              <a href="/contact/">Contact</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="main tmpl-post">
      
      <div class="container">
        <h1>Normalizing data using array.prototype.reduce</h1>

<time datetime="2019-07-18">18 Jul 2019</time><a href="/tags/javascript/" class="post-tag">javascript</a>

<p><strong>reduce() has terrified me for some time! I hadn't wanted to touch this new array method because I couldn't quite follow what each of it's properties meant. But recently I had an opportunity to deep dive into this function. Here's how I refactored an object to get the results I needed:</strong></p>
<p>I'm beginning to realise how important good API design is. One API I call for a project has only one endpoint: a list of items. Each item is quite large, with loads of tags and categories. Yet I can't query the API by any of those.</p>
<p>This became an issue when I had a requirement to display them by categories. The real trick was that the category was inside a nested object. AND it had to be matched and replaced by a different value before I displayed it.</p>
<p>Here's an example of the object once I'd parsed the JSON:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span><br>    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"some title"</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">categories</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token literal-property property">team</span><span class="token operator">:</span> <span class="token string">"teamone"</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>What I needed for it to be displayed was this:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span><br>    <span class="token literal-property property">teamone</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token punctuation">[</span><span class="token punctuation">{</span><br>            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"some title"</span><span class="token punctuation">,</span><br>            <span class="token literal-property property">categories</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>                <span class="token literal-property property">team</span><span class="token operator">:</span> <span class="token string">"teamone"</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>            <span class="token operator">...</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<h2 id="step-1:-map-and-replace-values" tabindex="-1">Step 1: Map &amp; Replace values <a class="direct-link" href="#step-1:-map-and-replace-values" aria-hidden="true">#</a></h2>
<p>The first thing I did was to map the new values of the team using the following method:</p>
<pre class="language-javascript"><code class="language-javascript"><br>itemsTeamsMap <span class="token punctuation">{</span><br>                <span class="token string-property property">"teamone"</span> <span class="token operator">:</span> <span class="token string">"team1"</span><span class="token punctuation">,</span><br>                <span class="token string-property property">"teamtwo"</span> <span class="token operator">:</span> <span class="token string">"team2"</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> itemsMapped <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br><br>  <span class="token keyword">const</span> filteredItems <span class="token operator">=</span> edges<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    item<span class="token punctuation">.</span>node<span class="token punctuation">.</span>categories<span class="token punctuation">.</span>team <span class="token operator">=</span> itemsTeamsMap<span class="token punctuation">[</span>item<span class="token punctuation">.</span>node<span class="token punctuation">.</span>categories<span class="token punctuation">.</span>team<span class="token punctuation">]</span><br>    itemsMapped<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>This was especially important because it wasn't a 1:1 match, some teams would be reassigned to other new values.</p>
<h2 id="step-2:-sort-items-using-reduce()" tabindex="-1">Step 2: Sort items using Reduce() <a class="direct-link" href="#step-2:-sort-items-using-reduce()" aria-hidden="true">#</a></h2>
<p>Once I had that, I needed to sort my items by the new team values I'd given them so that grouping would be easier using a bubble sort:</p>
<pre class="language-javascript"><code class="language-javascript">  <span class="token keyword">const</span> sortedItems <span class="token operator">=</span> ItemsMapped<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    acc<span class="token punctuation">[</span>current<span class="token punctuation">.</span>node<span class="token punctuation">.</span>categories<span class="token punctuation">.</span>team<span class="token punctuation">]</span> <span class="token operator">=</span> acc<span class="token punctuation">[</span>current<span class="token punctuation">.</span>node<span class="token punctuation">.</span>categories<span class="token punctuation">.</span>team<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>    acc<span class="token punctuation">[</span>current<span class="token punctuation">.</span>node<span class="token punctuation">.</span>categories<span class="token punctuation">.</span>team<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> acc<br>  <span class="token punctuation">}</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p>It took me a good while to get my head around the reduce function, something that's been called the most powerful function in JavaScript. The first argument is the accumulator value, or something which accumulates each iteration of the function.</p>
<p>The second value is the current item you're iterating over, which you can modify with any function you put into the body.</p>
<p>Here' I'm pushing the current value into the team item of each item in the accumulator and then creating an object from that value.</p>
<p>The result of this function on my original data is this:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span><br>    <span class="token literal-property property">team1</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br>            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'some title'</span><span class="token punctuation">,</span><br>            <span class="token literal-property property">categories</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>                <span class="token literal-property property">team</span><span class="token operator">:</span> <span class="token string">'team1'</span><br>                    <span class="token operator">...</span><br>            <span class="token punctuation">}</span><br>            <span class="token operator">...</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>            <span class="token operator">...</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token operator">...</span><br>    <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p>This was a good deal closer to the final object that I needed. Of course though, I needed an array of objects that I could iterate over in my JSX template...</p>
<h2 id="step-3:-array-of-objects" tabindex="-1">Step 3: Array of Objects <a class="direct-link" href="#step-3:-array-of-objects" aria-hidden="true">#</a></h2>
<pre class="language-javascript"><code class="language-javascript">  <span class="token keyword">const</span> finalisedItems <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>sortedItems<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><br>    <span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> <span class="token punctuation">[</span>team<span class="token punctuation">,</span> items<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span><br>      acc<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>        team<span class="token punctuation">,</span><br>        items<span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">[</span><span class="token punctuation">]</span><br>  <span class="token punctuation">)</span></code></pre>
<p>I love the new object methods introduced recently to JavaScript. They allow you to do so much more with objects natively ... in this function, for each entry of the object I'm passing in, it will concat the team into an array of objects, where team is the title, and each group of items is an array of objects inside of that:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token punctuation">{</span><br>        <span class="token literal-property property">team</span><span class="token operator">:</span> <span class="token string">'team1'</span><span class="token punctuation">,</span><br>        <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br>                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'some title'</span><span class="token punctuation">,</span><br>                <span class="token literal-property property">categories</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>                    <span class="token literal-property property">team</span><span class="token operator">:</span> <span class="token string">'team1'</span><br>                        <span class="token operator">...</span><br>                <span class="token punctuation">}</span><br>                <span class="token operator">...</span><br>            <span class="token punctuation">}</span><span class="token punctuation">,</span><br>            <span class="token operator">...</span><br>        <span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>        <span class="token literal-property property">team</span><span class="token operator">:</span> <span class="token string">'team2'</span><span class="token punctuation">,</span><br>        <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br>                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'some other title'</span><span class="token punctuation">,</span><br>                <span class="token literal-property property">categories</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>                    <span class="token literal-property property">team</span><span class="token operator">:</span> <span class="token string">'team2'</span><br>                        <span class="token operator">...</span><br>                <span class="token punctuation">}</span><br>                <span class="token operator">...</span><br>            <span class="token punctuation">}</span><span class="token punctuation">,</span><br>            <span class="token operator">...</span><br>        <span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token operator">...</span><br><span class="token punctuation">]</span></code></pre>
<p>Step 4: templating<br>
Now I can iterate over each team, then each item in that team, outputting semantic elements (‹li›s) for each item:</p>
<pre class="language-javascript"><code class="language-javascript"> <span class="token punctuation">{</span>finalisedItems<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">itemsTeam</span> <span class="token operator">=></span> <span class="token punctuation">(</span><br>        <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>itemsTeam<span class="token punctuation">.</span>team<span class="token punctuation">}</span><span class="token operator">></span><br>          <span class="token operator">&lt;</span>h3<span class="token operator">></span><span class="token punctuation">{</span>itemsTeam<span class="token punctuation">.</span>team<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span><br>          <span class="token operator">&lt;</span>ul<span class="token operator">></span><br>            <span class="token punctuation">{</span>itemsTeam<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">(</span><br>              <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">></span><br>                <span class="token operator">&lt;</span>a to<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>node<span class="token punctuation">.</span>url<span class="token punctuation">}</span><span class="token operator">></span><br>                  <span class="token punctuation">{</span>item<span class="token punctuation">.</span>node<span class="token punctuation">.</span>text<span class="token punctuation">}</span><br>                <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br>              <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><br>            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><br>          <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span><br>        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre>
<p>Going the extra mile in normalising this object isn't a challenge I relished, however I have improved a lot as a developer by working through and providing a solution.</p>
<p>I learned that trying to do a faster job didn't yield the correct results, so my fastest solution was by far the best.</p>
<p>Sometimes you've just got to knuckle down, go in for the long haul, and you'll find you've come out the other end similarly restructured (in a good way!)</p>

<hr>
<ul><li>Next: <a href="/posts/the-art-of-compromise/">The Art of Compromise</a></li><li>Previous: <a href="/posts/building-an-accordion-with-react-hooks/">Published Article: Building an Accordion Component with React Hooks</a></li>
</ul>

      </div>
    </main>

    <footer>
        <div class="footer-top">
          <div class="container">
            <blockquote>
              <span class="title">“Wisest are they who know they do not know.”</span>
              <attr>
                &mdash; Jostein Gaarder
              </attr>
            </blockquote>
          </div>
        </div>
        <div class="footer-bottom">
          <div class="container">
            <h2>About This Site</h2>
            <p><a href="/">Delicious Reverie</a> is the blog of developer & bookworm <span class="h-card">benjamin read</span>. Set in Lovechild and your system font. Built with <a href="https://www.11ty.dev">Eleventy</a> and <a href="https://slinkity.dev">Slinkity</a>, hosted by Netlify. &copy; Some rights are reserved. This site doesn't use any cookies or other session storage and has no tracking scripts.</p>
          <h3>Where you can find me:</h3>
            <ul class="list-inline">
              <li><a href="https://twitter.com/muzzlehatch_">twitter</a></li>
              <li><a href="https://www.linkedin.com/in/benjaminread1980/">linkedin</a></li>
              <li><a href="https://github.com/endymion1818/">github</a></li>
              <li><a href="/feed.xml">RSS Feed</a></li>
            </ul>
          </div>
        </div>
    </footer>
  </body>
</html>
