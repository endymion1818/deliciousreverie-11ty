<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creating my homepage animation</title>
    <meta name="description" content="I made the original animation for this site when I was using Hugo, but it&#39;s taken some time to refactor to React. Here&#39;s the story of how I achieved that.">
    <meta property="og:site_name" content="Creating my homepage animation">
    <meta property="og:locale" content="en_GB">
    <meta property="og:type" content="website">
    <meta property="og:description" content="I made the original animation for this site when I was using Hugo, but it&#39;s taken some time to refactor to React. Here&#39;s the story of how I achieved that.">
    <meta property="og:title" content="Creating my homepage animation" />
    <meta property="og:image" content="/img/sharecard-default.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@muzzlehatch_" />
    <meta name="twitter:title" content="Creating my homepage animation" />
    <meta
      name="twitter:description"
      content="I made the original animation for this site when I was using Hugo, but it&#39;s taken some time to refactor to React. Here&#39;s the story of how I achieved that."
    />
    <meta name="twitter:image" content="/img/sharecard-default.png" />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "headline": "Creating my homepage animation",
        "author": {
          "@type": "Person",
          "name": "Benjamin Read"
        },
        "datePublished": "2020-04-22T15:21:21+01:00",
        "image": "/img/sharecard-default.png"
      }
    </script>
    <link rel="icon" href="/img/icon.png" type="image/x-icon">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Delicious Reverie">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Delicious Reverie">
  </head>
  <body>
    <a id="skiplinks" href="#main">Skip to main content</a>
    <p class="themeswitcher">Choose theme:</p>
    <label class="themeswitcher" for="dark">Light</label>
    <input class="themeswitcher" type="radio" id="light" name="colors" value="light">
    <label  class="themeswitcher" for="dark">Dark</label>
    <input  class="themeswitcher" type="radio" id="dark" name="colors" value="dark">
    <header>
      <div class="container">
        <div class="title home"><a href="/">Delicious Reverie</a></div>
        <p class="subtitle">blog of developer &amp; bookworm benjamin read</p>
        <nav>
          <ul class="list-inline">
            <li class="nav-item">
              <a href="/">Home</a>
            </li>
            <li class="nav-item">
              <a href="/about/">About</a>
            </li>
            <li class="nav-item">
              <a href="/links/">Links</a>
            </li>
            <li class="nav-item">
              <a href="/posts/">Archive</a>
            </li>
            <li class="nav-item">
              <a href="/contact/">Contact</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="main tmpl-post">
      
      <div class="container">
        <h1>Creating my homepage animation</h1>

<time datetime="2020-04-22">22 Apr 2020</time><a href="/tags/javascript/" class="post-tag">javascript</a>

<p><strong>I made the original animation for this site when I was using Hugo, but it's taken some time to refactor to React. Here's the story of how I achieved that.</strong></p>
<p>I wanted this site to be pretty minimal, but a few nice little touches can really make a website stand out. That's why I made the animation here on the homepage. You have to scroll up &amp; down slowly to see it ...</p>
<h2 id="first-steps" tabindex="-1">First steps <a class="direct-link" href="#first-steps" aria-hidden="true">#</a></h2>
<p>The original animation was created with both ScrollMagic and GreenSock, two of the most incredibly diverse animation libraries available. The combination of these two is I think the easiest way of creating JavaScript animations when you're scrolling around, and I have used them to provide some pretty nice effects on sites I've worked on before.</p>
<p>However, the bundle sizes of GreenSock and ScrollMagic are ... quite large. I wanted to rewrite it because (1) I care about how much JavaScript I'm sending down (2) I want to see what I can achieve in plain JavaScript (3) I have the luxury of having no deadlines.</p>
<p>Here's the original animation on CodePen (137 lines):</p>
<p class="codepen" data-height="265" data-theme-id="light" data-default-tab="js" data-user="endymion1818" data-slug-hash="xrRyXw" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Animation on Scroll w/ ScrollMagic &amp;amp; GreenSock">
  <span>See the Pen <a href="https://codepen.io/endymion1818/pen/xrRyXw">
  Animation on Scroll w/ ScrollMagic &amp; GreenSock</a> by Ben Read (<a href="https://codepen.io/endymion1818">@endymion1818</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://static.codepen.io/assets/embed/ei.js"></script>
<p>Animations, especially ones where you're telling a story like this one, depend much on timing. I was particularly happy with the specific points that each rabbit became visible in this iteration, especially the last three, where the rabbit appears to be listening out for something, before dashing off the screen. It took a considerable investment of hours to get this right, so I've more or less kept this though the other implementations.</p>
<p>I've been told that this animation isn't prominent enough for most people to notice it. But I think that's partly the point: I like the idea that most people might not notice there is an animation: after all, most people aren't looking for that when they come to my site, so I didn't want to distract further their already distracted minds.</p>
<p>However, for those that do stop to notice, the brevity almost emphasises the subject matter more: it's only when we slow down ourselves that we start to notice the wonderful little things that are going on in nature around us.</p>
<p>The SVG images are free ones I found after trawling through a huge raft of websites selling, giving away, and pretending to give away, svgs.</p>
<h2 id="rebuild-in-javascript" tabindex="-1">Rebuild in JavaScript <a class="direct-link" href="#rebuild-in-javascript" aria-hidden="true">#</a></h2>
<p>For this re-implementation I made one significant change: the opacity of each rabbit is controlled by CSS, and doesn't fade in and out whilst you're scrolling. It's a a little bit of a cheat but I quite like how it makes the effect a little more dream like:</p>
<p class="codepen" data-height="265" data-theme-id="light" data-default-tab="js" data-user="endymion1818" data-slug-hash="ZEbGXgj" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Animation on Scroll (vanilla js)">
  <span>See the Pen <a href="https://codepen.io/endymion1818/pen/ZEbGXgj">
  Animation on Scroll (vanilla js)</a> by Ben Read (<a href="https://codepen.io/endymion1818">@endymion1818</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<p>This is only 35 lines, and without any libraries, it's much faster and better for users.</p>
<h2 id="rebuild-to-react" tabindex="-1">Rebuild to React <a class="direct-link" href="#rebuild-to-react" aria-hidden="true">#</a></h2>
<p>When I switched to React I was conscious that my JavaScript bundle had increased quite a lot, and I wanted to try to make compensation for that by implementing some other performance gains before I started getting fancy.</p>
<p>It took some time to get this to work in React. Building this honestly got me to question whether React is &quot;just javascript&quot; ...</p>
<div style="overflow: scroll">
<iframe
     src="https://codesandbox.io/embed/rabbit-animation-y2in6?fontsize=14&hidenavigation=1&module=%2Fsrc%2FRabbits.js&moduleview=1&theme=dark"
     style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;"
     title="rabbit animation"
     allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr"
     sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"
   ></iframe>
</div>
<p>(click the left side to see the code)</p>
<p>The actual animation code is 43 lines, a significant step up. There were a few tricky things I had to work out too:</p>
<p>React re-renders the page at different stages, so needs a way of getting the <em>current</em> element that's in the DOM. The <code>useRef()</code> hook allows us to do that. There's a caveat with that though: the initial value of <code>current</code> is <code>undefined</code>, it wasn't until I realised I needed to get the elements first then call them inside of a <code>useEffect()</code> hook.</p>
<p>It was also easier to use a pre-built hook, <code>react-use-scroll-position</code>, rather than write my own code. It's pretty minimal so I don't mind that too much.</p>
<h2 id="typescript-implementation" tabindex="-1">TypeScript implementation <a class="direct-link" href="#typescript-implementation" aria-hidden="true">#</a></h2>
<p>I'm using this one on my homepage now, but with TypeScript:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">Rabbits</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br><br>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">}</span><br>  <span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth <span class="token operator">&lt;</span> <span class="token number">998</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">}</span><br><br>  <span class="token keyword">const</span> scrollYPosition <span class="token operator">=</span> <span class="token function">useScrollYPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token keyword">function</span> <span class="token function">getScrollPercent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">(</span><br>        scrollYPosition <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><br>          <span class="token punctuation">(</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollHeight <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">)</span> <span class="token operator">-</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientHeight<br>      <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>  <span class="token keyword">const</span> <span class="token function-variable function">useScrollHeightToChangeOpacity</span> <span class="token operator">=</span> <span class="token punctuation">(</span><br>    <span class="token parameter"><span class="token literal-property property">domElement</span><span class="token operator">:</span>HTMLDivElement<span class="token punctuation">,</span><br>    <span class="token literal-property property">inHeight</span><span class="token operator">:</span>number<span class="token punctuation">,</span><br>    <span class="token literal-property property">outHeight</span><span class="token operator">:</span>number</span><br>  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getScrollPercent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> inHeight <span class="token operator">&amp;&amp;</span>  <span class="token function">getScrollPercent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> outHeight<span class="token punctuation">)</span><span class="token punctuation">{</span><br>      domElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token string">'0.8'</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>      domElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token string">'0'</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">const</span> treeSummer <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>  <span class="token keyword">const</span> rabbitOne <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>  <span class="token keyword">const</span> rabbitTwo <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>  <span class="token keyword">const</span> rabbitThree <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>  <span class="token keyword">const</span> rabbitFour <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>  <span class="token keyword">const</span> rabbitFive <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>  <span class="token keyword">const</span> rabbitSix <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><br>  <span class="token keyword">const</span> rabbitSeven <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token function">useScrollHeightToChangeOpacity</span><span class="token punctuation">(</span>rabbitOne<span class="token punctuation">.</span>current<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><br>      <span class="token function">useScrollHeightToChangeOpacity</span><span class="token punctuation">(</span>rabbitOne<span class="token punctuation">.</span>current<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><br>      <span class="token function">useScrollHeightToChangeOpacity</span><span class="token punctuation">(</span>rabbitTwo<span class="token punctuation">.</span>current<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><br>      <span class="token function">useScrollHeightToChangeOpacity</span><span class="token punctuation">(</span>rabbitThree<span class="token punctuation">.</span>current<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><br>      <span class="token function">useScrollHeightToChangeOpacity</span><span class="token punctuation">(</span>rabbitFour<span class="token punctuation">.</span>current<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><br>      <span class="token function">useScrollHeightToChangeOpacity</span><span class="token punctuation">(</span>rabbitFive<span class="token punctuation">.</span>current<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><br>      <span class="token function">useScrollHeightToChangeOpacity</span><span class="token punctuation">(</span>rabbitSix<span class="token punctuation">.</span>current<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><br>      <span class="token function">useScrollHeightToChangeOpacity</span><span class="token punctuation">(</span>rabbitSeven<span class="token punctuation">.</span>current<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>getScrollPercent<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>      <span class="token operator">...</span><br>  <span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<p>The hardest part of the TypeScript implementation was to find out how to get the <code>.current</code> value of <code>useRef()</code>, because the initial value as you can see is <code>null</code> (the dom element doesn't exist yet). Unfortunately the only help you get from the compiler is:</p>
<pre><code>Argument of type 'null' is not assignable to parameter of type 'HTMLDivElement'
</code></pre>
<p>To tell the compiler that it's not possible for this value to be <code>null</code> at this point, you append it with a <code>!</code>, the non-null assertion operator.</p>
<p>Annoying, but not annoying enough for me to change my position on TypeScript.</p>
<h2 id="future-plans" tabindex="-1">Future plans <a class="direct-link" href="#future-plans" aria-hidden="true">#</a></h2>
<p>If you have to ask why I chose this particular scene, it's because it reminds me both of my childhood days roaming the countryside of County Durham when such wildlife was abundant, and the film &quot;Watership Down&quot; (I watched that film when I was far too young!).</p>
<p>Originally, I planned ot have different animations on other pages too, like a bird or butterfly crossing the viewport, and a little girl sitting on a tree swing. I'm still thinking about whether or not to implement those, since the SVGs are quite large and it might not be good for my bundle size.</p>
<p>However I do really like how much character it lends to the site.</p>

<hr>
<ul><li>Next: <a href="/posts/what-is-typescript/">What is Typescript?</a></li><li>Previous: <a href="/posts/writing-tests-for-js-api-calls/">How to test JavaScript API Calls</a></li>
</ul>

      </div>
    </main>

    <footer>
        <div class="footer-top">
          <div class="container">
            <blockquote>
              <span class="title">“Wisest are they who know they do not know.”</span>
              <attr>
                &mdash; Jostein Gaarder
              </attr>
            </blockquote>
          </div>
        </div>
        <div class="footer-bottom">
          <div class="container">
            <h2>About This Site</h2>
            <p><a href="/">Delicious Reverie</a> is the blog of developer & bookworm <span class="h-card">benjamin read</span>. Set in Lovechild and your system font. Built with <a href="https://www.11ty.dev">Eleventy</a> and <a href="https://slinkity.dev">Slinkity</a>, hosted by Netlify. &copy; Some rights are reserved. This site doesn't use any cookies or other session storage and has no tracking scripts.</p>
          <h3>Where you can find me:</h3>
            <ul class="list-inline">
              <li><a href="https://twitter.com/muzzlehatch_">twitter</a></li>
              <li><a href="https://www.linkedin.com/in/benjaminread1980/">linkedin</a></li>
              <li><a href="https://github.com/endymion1818/">github</a></li>
              <li><a href="/feed.xml">RSS Feed</a></li>
            </ul>
          </div>
        </div>
    </footer>
  </body>
</html>
